<%= render :partial => 'vish_editor.full' %>

<script>	
	options = {};
	var configuration = {};

	configuration["mode"] = "vish";

	configuration["ImagesPath"] = "/assets/";
	configuration["StylesheetsPath"] = "/assets/";

	configuration["rootPath"] = "<%= IDeM::Application.config.full_domain %>";

	configuration["Upload"] = true;
	configuration["uploadImagePath"] = "#XXX KIKE FIX";
	configuration["uploadObjectPath"] = "#XXX KIKE FIX";
	configuration["uploadPresentationPath"] = "<%= presentation_path @presentation, :format=> "json" %>";
	configuration["uploadPDF2PPath"] = "#XXX KIKE FIX";

	// Sources enabled
	configuration["ViSH"] = true;
	configuration["ViSH_instances"] = ["<%= IDeM::Application.config.full_domain %>"];
	configuration["Flickr"] = true;
	<%unless IDeM::Application.config.APP_CONFIG['YouTubeAPIKEY'].nil? %>
		configuration["Youtube"] = true;
		configuration["YoutubeAPIKEY"] =  "<%= IDeM::Application.config.APP_CONFIG['YouTubeAPIKEY'] %>";
	<%end%>
	configuration["Vimeo"] = false;
	configuration["LRE"] = true;
	configuration["LRE_path"] = "/lre/search";
	<%unless IDeM::Application.config.APP_CONFIG['soundCloudAPIKEY'].nil? %>
		configuration["SoundCloud"] = true;
		configuration["SoundCloudAPIKEY"] =  "<%= IDeM::Application.config.APP_CONFIG['soundCloudAPIKEY'] %>";
	<%end%>
	<% unless IDeM::Application.config.APP_CONFIG['EuropeanaAPIKEY'].nil? %>
		configuration["Europeana"] = true;
		configuration["EuropeanaAPIKEY"] =  "<%= IDeM::Application.config.APP_CONFIG['EuropeanaAPIKEY'] %>";
	<% end %>

	configuration["presentationSettings"] = true;
	
	var tagsSettings = new Object();
	tagsSettings.maxLength = '<%=IDeM::Application.config.tagsSettings["maxLength"]%>';
	tagsSettings.maxTags = '<%=IDeM::Application.config.tagsSettings["maxTags"]%>';
	tagsSettings.triggerKeys = <%=raw(IDeM::Application.config.tagsSettings["triggerKeys"].to_json)%>; 
	configuration["tagsSettings"] = tagsSettings;

	//WAPP TOKEN API
	configuration["WAPP_TOKEN_API"] = {
		rootURL: "<%=IDeM::Application.config.full_domain%>" + "/apis/wapp_token"
	};

	options["configuration"] = configuration;
	

	options["developping"] = false;

	options["user"] = {
			name: "<%= @presentation.owner.name %>",
			id: "<%= @presentation.owner.id %>",
			token: "<%= form_authenticity_token %>"
	};

	options["draft"] = <%= @presentation.draft.to_s %>;

	options["lang"] = "<%= I18n.locale.to_s%>";

	<% if current_user %>
		<% if @presentation.draft.to_s == "false" %>
			options["exitURL"]  = "<%= presentation_path(@presentation) %>";
		<% else %>
			options["exitURL"]  = "<%= url_for(current_user) %>";
		<% end %>
	<% end %>

	options.addons = [];

	var addon = new Object();
	addon.target = "Both";
	addon.id = "IframeMessenger";
	addon.config = {enable: true};
	options.addons.push(addon);

	function start(){
		VISH.Editor.init(options, <%= raw @presentation.to_json%> );
	}
</script>
